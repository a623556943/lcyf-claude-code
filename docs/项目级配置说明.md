# 项目级配置说明

## 为什么使用项目级配置？

lcyf-claude-code v2.0 推荐使用**项目级配置**而非全局配置，原因如下：

### ✅ 优势

| 特性 | 项目级配置 | 全局配置 |
|------|-----------|---------|
| **团队协作** | ✅ 配置跟随项目，团队成员自动同步 | ❌ 每个人需手动配置 |
| **版本控制** | ✅ 配置纳入 Git 管理，可追溯变更 | ❌ 无法版本控制 |
| **独立环境** | ✅ 每个项目独立配置，互不干扰 | ❌ 所有项目共享配置 |
| **CI/CD 集成** | ✅ CI 环境可直接使用项目配置 | ❌ 需手动配置 CI 环境 |
| **规范一致性** | ✅ 强制团队统一规范 | ❌ 难以保证一致性 |
| **学习结果隔离** | ✅ 每个项目独立学习 | ❌ 学习结果混合 |

---

## 三种配置方案对比

### 方案A: Git 子模块（推荐）

**适用场景**: 希望自动同步 lcyf-claude-code 更新的团队项目

**优点**:
- ✅ 配置自动更新：`git submodule update --remote`
- ✅ 统一版本：团队成员使用相同的配置版本
- ✅ 变更可追溯：子模块版本记录在 Git 中
- ✅ 节省空间：多个项目共享一个子模块缓存

**缺点**:
- ❌ 需要创建符号链接（Windows 需管理员权限）
- ❌ 初次配置稍复杂

**命令**:
```bash
# 添加子模块
git submodule add https://github.com/a623556943/lcyf-claude-code.git .claude/lcyf-claude-code

# 更新配置
git submodule update --remote
```

---

### 方案B: 快速复制

**适用场景**: 希望独立管理配置的项目

**优点**:
- ✅ 简单直接：复制即可用
- ✅ 完全独立：修改不影响其他项目
- ✅ 无需符号链接

**缺点**:
- ❌ 手动更新：需重新复制文件
- ❌ 占用空间：每个项目完整复制

**命令**:
```bash
# 克隆并复制
git clone https://github.com/a623556943/lcyf-claude-code.git /tmp/lcyf-claude-code
cp -r /tmp/lcyf-claude-code/{agents,commands,skills,rules,templates} .claude/
```

---

### 方案C: 符号链接

**适用场景**: 已有全局配置，希望在特定项目中使用

**优点**:
- ✅ 共享配置：多个项目使用相同配置
- ✅ 节省空间：只有一份配置文件

**缺点**:
- ❌ 无版本控制：无法纳入 Git
- ❌ 依赖全局配置：需先在 `~/.claude/` 安装
- ❌ 仅限 macOS/Linux

**命令**:
```bash
# 链接到全局配置
ln -s ~/.claude/agents .claude/agents
ln -s ~/.claude/commands .claude/commands
ln -s ~/.claude/skills .claude/skills
ln -s ~/.claude/rules .claude/rules
ln -s ~/.claude/templates .claude/templates
```

---

## 目录结构

### 标准项目级配置结构

```
your-project/
├── .claude/                            # 项目级 Claude Code 配置
│   ├── lcyf-claude-code/              # 子模块（方案A）或直接文件（方案B）
│   │   ├── agents/
│   │   ├── commands/
│   │   ├── rules/
│   │   ├── skills/
│   │   └── templates/
│   ├── agents -> lcyf-claude-code/agents         # 符号链接（方案A）
│   ├── commands -> lcyf-claude-code/commands
│   ├── rules -> lcyf-claude-code/rules
│   ├── skills -> lcyf-claude-code/skills
│   ├── templates -> lcyf-claude-code/templates
│   ├── config.json                    # 项目配置
│   ├── learned-patterns/              # 学习模式（项目级）
│   ├── team-conventions/              # 团队约定（项目级）
│   └── instincts/                     # 本能规则（项目级）
├── src/
├── pom.xml
└── .gitignore
```

---

## Git 配置

### .gitignore 建议

**方案1: 提交配置，忽略学习结果（推荐）**
```gitignore
# lcyf-claude-code 学习结果（不提交）
.claude/learned-patterns/*
.claude/team-conventions/*
.claude/instincts/*

# 保留目录结构
!.claude/learned-patterns/.gitkeep
!.claude/team-conventions/.gitkeep
!.claude/instincts/.gitkeep
```

**方案2: 完全忽略 .claude（不推荐）**
```gitignore
.claude/
```

### .gitmodules（方案A专用）

使用 Git 子模块时自动生成：
```ini
[submodule ".claude/lcyf-claude-code"]
	path = .claude/lcyf-claude-code
	url = https://github.com/a623556943/lcyf-claude-code.git
	branch = master
```

---

## 项目配置文件

### config.json 示例

**基础配置**:
```json
{
  "projectName": "your-project",
  "moduleName": "system",
  "language": "zh_CN",
  "architecture": "lcyf-cloud"
}
```

**完整配置**:
```json
{
  "projectName": "lcyf-system",
  "moduleName": "system",
  "language": "zh_CN",
  "architecture": "lcyf-cloud",
  "techStack": {
    "java": "21",
    "springBoot": "3.5.x",
    "myBatisPlus": "3.5.x",
    "dubbo": "3.3.3",
    "mysql": "8.x",
    "redis": "7.x"
  },
  "team": {
    "name": "开发团队",
    "conventions": {
      "packagePrefix": "com.lcyf.cloud.module",
      "author": "lcyf-team",
      "dateFormat": "yyyy-MM-dd HH:mm:ss"
    }
  },
  "customRules": {
    "maxMethodLength": 50,
    "maxClassLength": 500,
    "requireTests": true,
    "minCoverage": 80
  }
}
```

---

## 团队协作流程

### 1. 项目创建者初始化

```bash
cd your-project

# 方案A: 添加子模块
git submodule add https://github.com/a623556943/lcyf-claude-code.git .claude/lcyf-claude-code
git submodule update --init --recursive

# 创建符号链接（根据平台选择命令）
# ... 创建符号链接

# 创建项目配置
mkdir -p .claude/{learned-patterns,team-conventions,instincts}
cat > .claude/config.json << 'EOF'
{
  "projectName": "your-project",
  "moduleName": "system",
  "language": "zh_CN",
  "architecture": "lcyf-cloud"
}
EOF

# 提交配置
git add .claude/ .gitmodules
git commit -m "feat: 添加 lcyf-claude-code 项目配置"
git push
```

### 2. 团队成员初始化

```bash
# 克隆项目
git clone https://github.com/your-org/your-project.git
cd your-project

# 初始化子模块
git submodule update --init --recursive

# 创建符号链接（根据平台选择命令）
# Windows (PowerShell - 管理员)
$lcyfPath = Join-Path (Get-Location) ".claude\lcyf-claude-code"
New-Item -ItemType SymbolicLink -Path ".\.claude\agents" -Target "$lcyfPath\agents" -Force
New-Item -ItemType SymbolicLink -Path ".\.claude\commands" -Target "$lcyfPath\commands" -Force
New-Item -ItemType SymbolicLink -Path ".\.claude\skills" -Target "$lcyfPath\skills" -Force
New-Item -ItemType SymbolicLink -Path ".\.claude\rules" -Target "$lcyfPath\rules" -Force
New-Item -ItemType SymbolicLink -Path ".\.claude\templates" -Target "$lcyfPath\templates" -Force

# macOS/Linux
ln -s "./.claude/lcyf-claude-code/agents" "./.claude/agents"
ln -s "./.claude/lcyf-claude-code/commands" "./.claude/commands"
ln -s "./.claude/lcyf-claude-code/skills" "./.claude/skills"
ln -s "./.claude/lcyf-claude-code/rules" "./.claude/rules"
ln -s "./.claude/lcyf-claude-code/templates" "./.claude/templates"

# 开始使用
claude-code .
```

### 3. 更新配置

```bash
# 项目创建者更新
cd your-project
git submodule update --remote
git add .claude/lcyf-claude-code
git commit -m "chore: 更新 lcyf-claude-code 配置"
git push

# 团队成员同步更新
git pull
git submodule update --remote
```

---

## CI/CD 集成

### GitHub Actions 示例

```yaml
name: Build and Test

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          submodules: recursive  # 自动初始化子模块

      - name: Setup Java
        uses: actions/setup-java@v3
        with:
          java-version: '21'

      - name: Create symlinks
        run: |
          ln -s "./.claude/lcyf-claude-code/agents" "./.claude/agents"
          ln -s "./.claude/lcyf-claude-code/commands" "./.claude/commands"
          ln -s "./.claude/lcyf-claude-code/rules" "./.claude/rules"
          ln -s "./.claude/lcyf-claude-code/skills" "./.claude/skills"
          ln -s "./.claude/lcyf-claude-code/templates" "./.claude/templates"

      - name: Build with Maven
        run: mvn clean install
```

---

## 自定义规范

### 项目级规范覆盖

项目级规范优先级 > 全局规范

**示例：自定义 Java 编码规范**

`.claude/rules/06-Java编码规范.md`:
```markdown
# 项目特定规范

## 扩展规范

本项目在 lcyf-cloud 基础规范上扩展：

### 特殊命名约定

- Controller 方法使用动词开头：`listUsers`, `getUser`
- Service 方法使用业务术语：`registerUser`, `activateAccount`

### 特殊注解要求

- 所有 Controller 方法必须添加 `@ApiOperation`
- 所有实体类必须添加 `@ApiModel`
```

---

## 常见问题

### Q: Windows 创建符号链接失败？

**原因**: Windows 需要管理员权限创建符号链接。

**解决方案**:
```powershell
# 以管理员身份运行 PowerShell
# 或启用开发者模式（Windows 10 1703+）
```

**替代方案**:
使用方案B（快速复制），不需要符号链接。

---

### Q: 子模块更新后如何同步？

```bash
# 更新子模块
git submodule update --remote

# 提交更新
git add .claude/lcyf-claude-code
git commit -m "chore: 更新 lcyf-claude-code"
git push
```

---

### Q: 如何在多个项目间共享自定义规范？

**方案1**: Fork lcyf-claude-code，添加团队规范
```bash
# Fork 仓库到团队组织
# 修改子模块 URL 为团队 Fork
git submodule add https://github.com/your-org/lcyf-claude-code.git .claude/lcyf-claude-code
```

**方案2**: 使用私有子模块
```bash
# 创建团队私有配置仓库
git submodule add https://github.com/your-org/team-conventions.git .claude/team-conventions
```

---

### Q: 如何回滚配置版本？

```bash
# 进入子模块
cd .claude/lcyf-claude-code

# 查看历史版本
git log --oneline

# 回滚到特定版本
git checkout <commit-hash>

# 返回项目根目录
cd ../..

# 提交回滚
git add .claude/lcyf-claude-code
git commit -m "chore: 回滚 lcyf-claude-code 到版本 xxx"
```

---

## 最佳实践

### ✅ 推荐做法

1. **使用方案A（Git 子模块）** - 便于团队协作和更新
2. **提交配置到 Git** - 确保团队一致性
3. **忽略学习结果** - 避免 Git 冲突
4. **定期更新子模块** - 获取最新特性和修复
5. **添加项目配置文件** - 自定义项目特定设置

### ❌ 避免做法

1. ❌ 直接修改子模块内容 - 应 Fork 后修改
2. ❌ 提交学习结果到 Git - 会导致频繁冲突
3. ❌ 混用全局和项目级配置 - 导致行为不一致
4. ❌ 忽略符号链接创建 - 配置不生效

---

## 迁移指南

### 从全局配置迁移到项目级

```bash
cd your-project

# 1. 添加子模块
git submodule add https://github.com/a623556943/lcyf-claude-code.git .claude/lcyf-claude-code

# 2. 创建符号链接（同前）

# 3. 复制已学习的模式（可选）
cp -r ~/.claude/learned-patterns .claude/
cp -r ~/.claude/team-conventions .claude/

# 4. 提交
git add .claude/
git commit -m "feat: 迁移到项目级配置"
```

---

**使用项目级配置，让团队开发更高效！**
