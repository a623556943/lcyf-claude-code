# 项目级配置说明

## 什么是项目级配置？

将 lcyf-claude-code 配置放在项目的 `.claude/` 目录下，而不是全局 `~/.claude/` 目录。

## 优势

| 特性 | 项目级配置 | 全局配置 |
|------|-----------|---------|
| 团队共享 | ✅ | ❌ |
| 版本控制 | ✅ | ❌ |
| 独立环境 | ✅ | ❌ |
| CI/CD 集成 | ✅ | ❌ |
| 多项目支持 | ✅ | ❌ |

---

## 安装

```bash
cd your-project
git clone https://github.com/a623556943/lcyf-claude-code.git .claude
```

---

## 配置文件详解

### `.claude-skills-config.json` [重要]

**最关键的配置文件**，定义 Skills 的注册与自动加载：

```json
{
  "version": "1.0.0",
  "lastUpdated": "2026-01-30",
  "registeredSkills": [
    {
      "id": "system-auth-user",
      "name": "用户账号与认证管理",
      "path": "skills/system-auth-user/SKILL.md",
      "category": "系统认证与权限",
      "triggers": ["用户", "user", "账号", "认证", "登录"],
      "supportedAgents": ["java-developer", "planner"],
      "enabled": true
    }
    // ... 80+ 个 skills 定义
  ],
  "autoLoadRules": {
    "enabled": true,
    "caseSensitive": false
  }
}
```

**关键字段**:
- `id`: Skill 的唯一标识
- `triggers`: 触发词列表（任务中包含这些词会自动加载此 skill）
- `supportedAgents`: 支持这个 skill 的 agents
- `enabled`: 是否启用自动加载

### `hooks/hooks.json`

定义自动化钩子，在特定操作时触发：

```json
{
  "PreToolUse": [
    {
      "matcher": "tool == \"Bash\" && tool_input.command matches \"mvn.*test\"",
      "hooks": [{"type": "command", "command": "..."}],
      "description": "提醒长时间测试在tmux中运行"
    }
  ],
  "PostToolUse": [
    {
      "matcher": "tool == \"Edit\" && tool_input.file_path matches \"\.java$\"",
      "hooks": [{"type": "command", "command": "..."}],
      "description": "Java文件编辑后检查常见问题"
    }
  ]
}
```

**Hook 类型**:
- `PreToolUse`: 工具执行前（验证、参数修改）
- `PostToolUse`: 工具执行后（自动检查、格式化）
- `Stop`: 会话结束时（最终验证）
- `SessionStart`: 会话开始时（欢迎信息）

### `mcp-configs/mcp-servers.json`

MCP 服务器配置（可选）：

```json
{
  "mcpServers": {
    "context7": {
      "command": "npx",
      "args": ["@modelcontextprotocol/server-context7"]
    }
  }
}
```

---

## 多仓库聚合项目配置

### 项目结构

```
lcyf-project/                    # 项目根目录
├── .claude/                      # [重要] 在这里安装配置
├── lcyf-module-base/            # 各模块都可以共享 .claude
├── lcyf-module-system/
├── lcyf-module-finance/
├── lcyf-module-policy/
└── lcyf-module-product-*
```

### 安装方式

```bash
# 在项目根目录安装（一次性）
cd /path/to/lcyf-project
git clone https://github.com/a623556943/lcyf-claude-code.git .claude

# 所有子模块都自动可用
cd lcyf-module-system
# 会自动使用 ../../.claude/ 配置

cd ../lcyf-module-finance
# 也会自动使用 ../../.claude/ 配置
```

### 关键优势

1. **版本统一**: 所有模块使用同一份配置版本
2. **规范统一**: 统一的 Java 规范、API 规范、Git 工作流
3. **Skill 共享**: 80+ 个 skills 对所有模块可用
4. **Hooks 统一**: 所有模块享受相同的自动化检查

---

## 自定义规范

### 修改编码规范

在 `.claude/rules/` 下修改或新增规范文件：

```bash
# 编辑 Java 规范
vim .claude/rules/01-Java开发规范.md

# 新增项目特定规范
vim .claude/rules/06-项目特定规范.md
```

项目级规范会覆盖全局规范。

### 添加自定义 Skill

1. 在 `.claude/skills/` 下创建新目录:

```bash
mkdir -p .claude/skills/my-custom-skill
```

2. 创建 `SKILL.md`:

```markdown
# 自定义 Skill

## 模块职责
...

## 功能清单
...
```

3. 在 `.claude-skills-config.json` 中注册：

```json
{
  "id": "my-custom-skill",
  "name": "自定义技能",
  "path": "skills/my-custom-skill/SKILL.md",
  "triggers": ["自定义", "custom"],
  "enabled": true
}
```

---

## CI/CD 集成

### GitHub Actions

`.claude/` 目录包含在项目中，CI 环境自动可用：

```yaml
# .github/workflows/build.yml
- name: Checkout
  uses: actions/checkout@v3

- name: Build
  run: mvn clean install
  # .claude/ 配置已自动包含，无需额外配置

- name: Code Review
  # 可以在 CI 中使用 Claude Code 进行代码审查
```

### GitLab CI

```yaml
# .gitlab-ci.yml
build:
  script:
    - mvn clean install
    # .claude/ 配置自动可用
```

---

## 更新和维护

### 更新配置

```bash
cd .claude
git pull
```

### 查看更新日志

```bash
cd .claude
git log --oneline -20
```

### 回滚到之前版本

```bash
cd .claude
git log --oneline
git checkout <commit-hash>
```

---

## 常见问题

### Q: 多个项目如何处理？

**方案 1**（推荐）: 每个项目有独立的 `.claude/` 配置

```bash
project-1/
├── .claude/          # 项目 1 的配置
└── src/

project-2/
├── .claude/          # 项目 2 的配置
└── src/
```

**方案 2**: 模块化聚合项目共享一份配置

```bash
lcyf-project/
├── .claude/          # 所有模块共享
├── lcyf-module-system/
├── lcyf-module-finance/
└── lcyf-module-policy/
```

### Q: 如何自定义 Skills？

编辑 `.claude-skills-config.json` 中的 `registeredSkills` 部分，或在 `.claude/skills/` 下添加新的 skill 目录。

### Q: 如何修改触发词？

在 `.claude-skills-config.json` 中修改 `triggers` 数组：

```json
{
  "id": "system-auth-user",
  "triggers": ["用户", "user", "账号", "认证", "登录", "新增触发词"]
}
```

### Q: 知识库存储在哪？

在项目的 `docs/knowledge/` 目录。这个目录通常不提交到 Git：

```bash
echo "docs/knowledge/" >> .gitignore
```

### Q: 能否禁用某些 Skills？

可以。在 `.claude-skills-config.json` 中将 `enabled` 设为 `false`：

```json
{
  "id": "system-auth-user",
  "enabled": false
}
```

---

## 最佳实践

1. **提交 `.claude/` 到仓库**: 让团队都能使用相同配置
2. **定期更新**: `cd .claude && git pull`
3. **自定义规范**: 针对项目特点修改 `rules/` 文件
4. **管理 Hooks**: 根据需要在 `hooks/hooks.json` 中添加检查
5. **不提交 `docs/knowledge/`**: 这是动态知识库，不需要版本控制

---

**使用项目级配置，让团队开发更高效！**
