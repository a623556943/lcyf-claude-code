# 迁移指南：v1.0 → v2.0

## 概述

本指南帮助你从 lcyf-claude-code v1.0 平滑迁移到 v2.0。

v2.0 是革命性重构版本，引入了持续学习、验证引擎、模块协调等全新特性。

## 版本差异

### 架构变化

| 方面 | v1.0 | v2.0 |
|------|------|------|
| 架构 | 简单工具集合 | 三层架构（智能层/工作流层/基础层） |
| Agents | 4个 | 8个专家 |
| Commands | 5个 | 20个 |
| Rules | 4条 | 11条 |
| 学习能力 | 无 | 持续学习引擎 |
| 验证能力 | 手动 | 自动验证引擎 |
| 模块支持 | 基础 | 深度模块协调 |
| CLI工具 | 无 | 完整CLI |

### 命令映射

| v1.0 命令 | v2.0 命令 | 说明 |
|-----------|-----------|------|
| `/lcyf-new-feature` | `/lcyf-新功能` | 完整新功能开发流程 |
| `/lcyf-review` | `/lcyf-代码审查` | 代码质量审查 |
| `/lcyf-db-review` | `/lcyf-数据库审查` | 数据库设计审查 |
| `/lcyf-api-review` | `/lcyf-API审查` | API设计审查 |
| `/lcyf-module-check` | `/lcyf-模块检查` | 模块依赖检查 |
| 无 | `/lcyf-tdd` | 测试驱动开发（新增） |
| 无 | `/lcyf-验证` | 全面验证（新增） |
| 无 | `/lcyf-自动` | 智能命令选择（新增） |

### 文件结构变化

```
v1.0                           v2.0
----                           ----
agents/                   →    agents/（8个专家）
  ├── java-reviewer.md          ├── 01-规划专家.md
  ├── api-designer.md           ├── 02-架构专家.md
  ├── db-optimizer.md           ├── 03-Java开发专家.md
  └── module-coordinator.md     ├── 04-模块协调专家.md
                                ├── 05-代码审查专家.md
                                ├── 06-安全审查专家.md
                                ├── 07-测试专家.md
                                └── 08-学习代理.md

skills/                   →    skills/（重组）
  ├── java-dev/                 ├── workflows/
  ├── database-design/          ├── java-full-stack/
  ├── api-design/               ├── modular-monolith/
  ├── module-design/            ├── continuous-learning/
  └── lcyf-workflow/            ├── verification-loop/
                                └── team-knowledge/

无                        →    core/（新增）
                                ├── learning-engine/
                                ├── verification-engine/
                                └── orchestrator/

无                        →    .lcyf/（知识库目录）
```

## 迁移步骤

### 步骤1：备份现有配置

```bash
# 备份整个项目
cp -r D:\lcyf-claude-code D:\lcyf-claude-code-v1-backup

# 或只备份自定义内容
cp -r D:\lcyf-claude-code\skills\team-knowledge D:\backup\
cp D:\lcyf-claude-code\examples\CLAUDE.md D:\backup\
```

### 步骤2：获取v2.0

```bash
# 方式1：更新现有仓库
cd D:\lcyf-claude-code
git fetch origin
git checkout v2.0

# 方式2：重新克隆
git clone -b v2.0 https://github.com/a623556943/lcyf-claude-code.git D:\lcyf-claude-code-v2
```

### 步骤3：安装依赖

```bash
cd D:\lcyf-claude-code
npm install
```

### 步骤4：运行迁移脚本

```bash
# 自动迁移
lcyf migrate --from v1.0

# 或手动指定备份目录
lcyf migrate --from v1.0 --backup D:\lcyf-claude-code-v1-backup
```

### 步骤5：迁移自定义内容

#### 迁移团队知识

```bash
# 旧位置
skills/team-knowledge/

# 新位置
skills/team-knowledge/
.lcyf/team-conventions/
```

手动复制自定义的团队知识文件。

#### 迁移自定义模板

```bash
# 旧位置
templates/

# 新位置（格式变化）
templates/java/
templates/sql/
```

需要将模板更新为新的 Mustache 语法。

#### 迁移项目配置

v1.0 配置（`examples/CLAUDE.md`）:
```markdown
# lcyf Project Configuration
使用 lcyf-claude-code 工具链进行开发
## 技术栈
- Java 17 / Spring Boot 3.5.x
```

v2.0 配置（`.lcyf/config.json`）:
```json
{
  "project": {
    "name": "lcyf-cloud",
    "basePackage": "com.lcyf.cloud",
    "javaVersion": "17",
    "springBootVersion": "3.5.x"
  }
}
```

### 步骤6：验证迁移

```bash
# 验证配置
lcyf validate

# 检查组件
lcyf status

# 测试功能
lcyf test
```

### 步骤7：初始化新功能

```bash
# 初始化知识库
lcyf knowledge init

# 配置团队设置
lcyf team setup

# 启用持续学习
lcyf config set features.continuousLearning true
```

## 配置映射表

### Rules 映射

| v1.0 规则 | v2.0 规则 |
|-----------|-----------|
| `java-coding-standards.md` | `06-Java编码规范.md` |
| `spring-boot-best-practices.md` | `07-SpringBoot最佳实践.md` |
| `api-design-rules.md` | `09-API设计规范.md` |
| `database-design-rules.md` | `10-数据库设计规范.md` |
| 无 | `00-总则.md`（新增） |
| 无 | `01-安全规范.md`（新增） |
| 无 | `02-编码风格.md`（新增） |
| 无 | `03-测试要求.md`（新增） |
| 无 | `04-Git工作流.md`（新增） |
| 无 | `05-性能优化.md`（新增） |
| 无 | `08-MyBatis规范.md`（新增） |
| 无 | `11-模块依赖规范.md`（新增） |

### Agents 映射

| v1.0 Agent | v2.0 Agent | 说明 |
|------------|------------|------|
| `java-reviewer` | `03-Java开发专家` + `05-代码审查专家` | 职责拆分 |
| `api-designer` | `03-Java开发专家` | 合并到Java专家 |
| `db-optimizer` | `03-Java开发专家` | 合并到Java专家 |
| `module-coordinator` | `04-模块协调专家` | 保留并增强 |
| 无 | `01-规划专家` | 新增 |
| 无 | `02-架构专家` | 新增 |
| 无 | `06-安全审查专家` | 新增 |
| 无 | `07-测试专家` | 新增 |
| 无 | `08-学习代理` | 新增 |

## 常见问题

### Q1: 旧命令还能用吗？

A: v2.0 提供了命令别名，旧命令会自动映射到新命令：

```bash
# 旧命令（仍可用）
/lcyf-new-feature

# 自动映射到
/lcyf-新功能
```

### Q2: 自定义的Skills会丢失吗？

A: 不会。迁移脚本会自动检测并保留自定义Skills。但建议手动检查并更新格式。

### Q3: 知识库数据如何迁移？

A: v1.0 没有知识库功能。v2.0 会从零开始构建知识库，建议：
1. 整理现有团队文档
2. 放入 `skills/team-knowledge/`
3. 运行 `lcyf knowledge init`

### Q4: 模板语法变化大吗？

A: 是的，v2.0 使用 Mustache 语法。需要更新模板：

v1.0 模板:
```java
package ${packageName};
public class ${className} {}
```

v2.0 模板:
```java
package {{packageName}};
public class {{className}} {}
```

### Q5: 迁移后构建失败怎么办？

A: 运行诊断命令：
```bash
lcyf validate --verbose
lcyf fix --auto
```

### Q6: 如何回滚？

A: 使用备份恢复：
```bash
# 删除v2.0
rm -rf D:\lcyf-claude-code

# 恢复v1.0
mv D:\lcyf-claude-code-v1-backup D:\lcyf-claude-code
```

## 迁移检查清单

- [ ] 备份v1.0配置
- [ ] 获取v2.0代码
- [ ] 安装依赖
- [ ] 运行迁移脚本
- [ ] 迁移团队知识
- [ ] 迁移自定义模板
- [ ] 更新项目配置
- [ ] 验证配置
- [ ] 测试核心功能
- [ ] 初始化知识库
- [ ] 配置团队设置
- [ ] 通知团队成员

## 获取帮助

- **文档**: `docs/` 目录
- **Issues**: https://github.com/a623556943/lcyf-claude-code/issues
- **讨论**: 团队内部沟通群

## 版本历史

- **v2.0.0** (2025-01-26) - 革命性重构版本
- **v1.0.0** (2024-xx-xx) - 初始版本
