# 02-编码风格

## 概述

统一的编码风格提高代码可读性和团队协作效率。

## 代码格式

### 缩进与空格

```java
// ✅ 使用4个空格缩进
public class UserService {
    private UserMapper userMapper;

    public User getById(Long id) {
        return userMapper.selectById(id);
    }
}

// ✅ 运算符两侧加空格
int result = a + b;
String name = user != null ? user.getName() : "unknown";

// ✅ 逗号后加空格
public void method(String a, String b, String c) {}
List.of("a", "b", "c");
```

### 大括号

```java
// ✅ 大括号同行（K&R风格）
if (condition) {
    // code
} else {
    // code
}

// ✅ 单行语句也使用大括号
if (condition) {
    return true;
}

// ❌ 避免省略大括号
if (condition)
    return true;
```

### 行长度

- 最大行长度：120字符
- 超长时合理换行

```java
// ✅ 方法调用换行
String result = someService
    .methodWithLongName()
    .anotherMethod()
    .finalMethod();

// ✅ 参数过多时换行
public void methodWithManyParams(
        String param1,
        String param2,
        String param3,
        String param4) {
    // ...
}
```

## 命名规范

### 类命名

| 类型 | 规范 | 示例 |
|------|------|------|
| 类 | PascalCase | UserService |
| 接口 | I + PascalCase | IUserService |
| 抽象类 | Abstract + PascalCase | AbstractHandler |
| 异常类 | PascalCase + Exception | BusinessException |
| 枚举 | PascalCase + Enum | StatusEnum |

### 方法命名

| 类型 | 前缀 | 示例 |
|------|------|------|
| 获取单个 | get | getById, getUserByName |
| 获取列表 | list | listByStatus, listAll |
| 分页查询 | page | pageByCondition |
| 创建 | create | createUser |
| 更新 | update | updateUser |
| 删除 | delete | deleteById |
| 判断 | is/has/can | isValid, hasPermission |
| 转换 | to/convert | toDTO, convertToEntity |

### 变量命名

```java
// ✅ 有意义的名称
User currentUser;
List<Order> pendingOrders;
int maxRetryCount;

// ❌ 避免无意义的名称
User u;
List<Order> list;
int n;

// ✅ 布尔变量使用is/has/can前缀
boolean isActive;
boolean hasPermission;
boolean canEdit;

// ✅ 常量使用全大写+下划线
private static final int MAX_RETRY_COUNT = 3;
private static final String DEFAULT_CHARSET = "UTF-8";
```

## 注释规范

### 类注释

```java
/**
 * 用户服务实现类
 *
 * <p>处理用户相关的业务逻辑，包括用户的增删改查、
 * 权限验证、状态管理等功能。</p>
 *
 * @author 张三
 * @since 2025-01-01
 */
public class UserServiceImpl implements IUserService {
}
```

### 方法注释

```java
/**
 * 根据ID获取用户信息
 *
 * @param id 用户ID，不能为空
 * @return 用户信息，如果不存在返回null
 * @throws IllegalArgumentException 如果id为null
 */
public User getById(Long id) {
}
```

### 代码注释

```java
// ✅ 解释"为什么"，而不是"是什么"
// 使用乐观锁防止并发更新冲突
@Version
private Integer version;

// ❌ 避免无意义的注释
// 获取用户
User user = userService.getById(id);
```

## 代码组织

### 类结构顺序

```java
public class UserService {
    // 1. 静态常量
    private static final int MAX_RETRY = 3;

    // 2. 静态变量
    private static Logger log = LoggerFactory.getLogger(UserService.class);

    // 3. 实例变量
    private final UserMapper userMapper;
    private final CacheService cacheService;

    // 4. 构造方法
    public UserService(UserMapper userMapper, CacheService cacheService) {
        this.userMapper = userMapper;
        this.cacheService = cacheService;
    }

    // 5. 公共方法
    public User getById(Long id) { }

    // 6. 私有方法
    private void validateUser(User user) { }
}
```

### 方法长度

- 单个方法不超过50行
- 超过时考虑拆分

```java
// ❌ 过长的方法
public void processOrder(Order order) {
    // 100+ 行代码...
}

// ✅ 拆分为小方法
public void processOrder(Order order) {
    validateOrder(order);
    calculatePrice(order);
    applyDiscount(order);
    saveOrder(order);
    sendNotification(order);
}
```

## 异常处理

### 异常捕获

```java
// ✅ 捕获具体异常
try {
    userService.save(user);
} catch (DuplicateKeyException e) {
    throw new BusinessException("用户名已存在", e);
}

// ❌ 避免捕获Exception
try {
    userService.save(user);
} catch (Exception e) {
    // 太宽泛
}

// ✅ 不要吞掉异常
try {
    // ...
} catch (IOException e) {
    log.error("文件操作失败", e);
    throw new BusinessException("操作失败", e);
}

// ❌ 不要吞掉异常
try {
    // ...
} catch (IOException e) {
    // 空的catch块
}
```

## 关联Agent

- 05-代码审查专家.md：代码风格检查
