# /lcyf-自动

## 元数据
- **使用 Agents:** 所有Agents（智能选择）
- **遵循 Rules:** 00-总则

## 命令说明
智能分析用户意图，自动选择并执行最合适的命令

## 使用方式

```
/lcyf-自动 <任务描述>
```

## 工作原理

### 1. 意图识别

根据关键词和上下文分析用户意图：

```javascript
意图分类表
=========
新功能开发 → /lcyf-新功能
  关键词: "添加"、"新增"、"实现"、"开发"

Bug修复 → /lcyf-修复Bug
  关键词: "修复"、"fix"、"bug"、"问题"

规划设计 → /lcyf-规划
  关键词: "规划"、"设计"、"方案"、"架构"

代码质量 → /lcyf-代码审查
  关键词: "审查"、"检查"、"优化"、"质量"

安全检查 → /lcyf-安全审查
  关键词: "安全"、"漏洞"、"风险"、"加密"

测试相关 → /lcyf-tdd 或 /lcyf-测试覆盖
  关键词: "测试"、"单元测试"、"覆盖率"

构建问题 → /lcyf-构建修复
  关键词: "构建失败"、"编译错误"、"打包失败"

性能问题 → /lcyf-性能优化
  关键词: "慢"、"性能"、"优化"、"卡顿"

模块问题 → /lcyf-模块检查
  关键词: "模块"、"依赖"、"循环依赖"

数据库相关 → /lcyf-数据库审查
  关键词: "数据库"、"SQL"、"表设计"、"索引"

API相关 → /lcyf-API审查
  关键词: "API"、"接口"、"RESTful"

重构清理 → /lcyf-重构清理
  关键词: "重构"、"清理"、"优化代码"

文档更新 → /lcyf-更新文档
  关键词: "文档"、"README"、"说明"

验证检查 → /lcyf-验证
  关键词: "验证"、"检验"、"确认"、"ready"
```

### 2. 上下文分析

结合当前项目状态：

```javascript
上下文因素
=========
1. Git状态
   - 有未提交更改 → 考虑代码审查/验证
   - 分支名包含"feature" → 新功能开发
   - 分支名包含"fix" → Bug修复

2. 最近错误
   - 构建失败 → 构建修复
   - 测试失败 → TDD/测试覆盖

3. 文件类型
   - Controller文件 → API审查
   - Mapper.xml文件 → 数据库审查
   - pom.xml修改 → 模块检查
```

### 3. 智能决策

```
决策优先级
=========
1. 安全 > 功能 > 性能 > 文档
2. 修复 > 新增
3. 测试 > 实现
```

## 决策流程图

```
用户输入
  ↓
关键词提取
  ↓
意图匹配 ─────→ 多个匹配？ ─→ 显示选项让用户确认
  ↓              ↓
单一匹配        用户选择
  ↓              ↓
上下文验证 ←────┘
  ↓
显示选择的命令
  ↓
用户确认
  ↓
执行命令
```

## 使用示例

### 示例1: 新功能开发

```
用户: /lcyf-自动 我需要添加用户登录功能

Claude:
正在分析任务...

意图识别: 新功能开发
关键词: "添加"、"功能"
上下文: Git分支 feature/user-login

推荐命令: /lcyf-新功能
理由:
- 需要完整的开发流程（规划→实现→测试→审查）
- 涉及安全敏感功能（登录），需要安全审查
- 新功能需要充分的测试覆盖

是否执行 /lcyf-新功能？[Y/n]
```

### 示例2: 构建错误

```
用户: /lcyf-自动 我的项目构建失败了，有很多编译错误

Claude:
正在分析任务...

意图识别: 构建修复
关键词: "构建失败"、"编译错误"
上下文: 检测到最近一次构建失败

推荐命令: /lcyf-构建修复
理由:
- 存在编译错误，需要逐个修复
- 使用增量修复策略更安全
- 自动验证每次修复

是否执行 /lcyf-构建修复？[Y/n]
```

### 示例3: 多个匹配

```
用户: /lcyf-自动 检查一下代码

Claude:
正在分析任务...

检测到多个可能的意图：

1. /lcyf-代码审查 (推荐)
   - 全面的代码质量检查
   - 检查规范、性能、可维护性

2. /lcyf-安全审查
   - 专注于安全漏洞
   - 适合敏感代码

3. /lcyf-验证
   - 快速验证构建和测试
   - 适合提交前检查

请选择: [1/2/3]
```

### 示例4: 智能建议

```
用户: /lcyf-自动 优化性能

Claude:
正在分析任务...

意图识别: 性能优化
上下文分析:
- 检测到多个慢查询（OrderMapper.xml）
- Redis缓存未启用
- 存在N+1查询问题

推荐执行顺序:
1. /lcyf-数据库审查 - 优先检查SQL性能
2. /lcyf-性能优化 - 整体性能分析
3. /lcyf-代码审查 - 检查代码层面优化机会

是否按此顺序执行？[Y/n]
或选择单个命令: [1/2/3/n]
```

## 决策规则库

### 规则1: 安全优先
```
IF 关键词包含 ["密码", "加密", "token", "安全"]
THEN 推荐 /lcyf-安全审查
```

### 规则2: 构建失败立即修复
```
IF 上次构建失败
AND 用户提到 "编译" 或 "构建"
THEN 强制推荐 /lcyf-构建修复
```

### 规则3: 新功能需要规划
```
IF 任务描述 > 50字
AND 关键词包含 "新功能"
THEN 推荐先执行 /lcyf-规划
```

### 规则4: 提交前必须验证
```
IF Git有未提交更改
AND 用户提到 "提交" 或 "commit"
THEN 推荐先执行 /lcyf-验证 pre-commit
```

### 规则5: 模块变更需要检查
```
IF 修改了 pom.xml
OR 修改了模块间接口
THEN 推荐执行 /lcyf-模块检查
```

## 学习能力

系统会学习用户的使用习惯：

```
学习数据存储
============
.lcyf/learning/
├── intent-history.json      # 意图识别历史
├── command-frequency.json   # 命令使用频率
└── user-preferences.json    # 用户偏好
```

随着使用次数增加，决策会越来越准确：

```json
{
  "user_patterns": {
    "feature_workflow": "规划 → TDD → 代码审查 → 安全审查",
    "bug_workflow": "验证 → 修复 → 测试覆盖",
    "preferred_agents": ["Java开发专家", "测试专家"],
    "skip_confirmation": ["代码审查", "验证"]
  }
}
```

## 交互模式

### 自动模式（默认）
显示推荐命令，等待用户确认

### 静默模式
```
/lcyf-自动 --silent <任务描述>
```
不需要确认，直接执行最匹配的命令

### 解释模式
```
/lcyf-自动 --explain <任务描述>
```
只显示决策过程，不执行命令

### 批量模式
```
/lcyf-自动 --batch <任务1> <任务2> <任务3>
```
一次处理多个任务

## 注意事项

- **首次使用需要学习**: 前几次可能需要手动确认
- **复杂任务建议分解**: 非常复杂的任务拆分为多步
- **危险操作需要确认**: 删除、重构等操作会强制确认
- **保持描述清晰**: 越清晰的描述，识别越准确

## 相关命令

所有 lcyf 命令都可以被 /lcyf-自动 调用

## 典型对话

```
用户: /lcyf-自动 帮我看看这个API接口有什么问题

Claude:
正在分析...

检测到的问题:
1. UserController.java - 缺少参数验证
2. 未定义统一异常处理
3. 返回值格式不统一

推荐: /lcyf-API审查
是否执行？[Y/n] y

正在执行 /lcyf-API审查...

[执行API审查流程...]

审查完成！发现3个问题，已生成修复建议。
下一步建议: /lcyf-代码审查 确保整体质量
```
