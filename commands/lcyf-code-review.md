---
description: 执行全面的代码质量审查，包括规范检查、安全扫描、测试覆盖率分析。适合代码提交前或PR审查时使用。
---

# /lcyf-code-review

## 概述

执行全面的代码质量审查，包括规范检查、安全扫描、测试覆盖率分析。

## 用法

```
/lcyf-code-review
/lcyf-code-review --scope=changed    # 只审查变更的文件
/lcyf-code-review --scope=module --module=system  # 审查指定模块
/lcyf-code-review --include-security  # 包含深度安全扫描
```

## 审查范围

### 默认范围
- Git暂存区的文件
- 未提交的修改

### 可选范围
- `--scope=changed` - 变更的文件
- `--scope=module` - 指定模块
- `--scope=all` - 整个项目

## 审查内容

### 1. 代码规范检查

**执行Agent**: code-reviewer

**检查项**:
- 命名规范
- 代码格式
- 注释规范
- 代码复杂度

### 2. 安全扫描

**执行Agent**: security-reviewer

**检查项**:
- 硬编码密钥
- SQL注入风险
- XSS风险
- 权限配置

### 3. 测试覆盖率

**执行Agent**: tdd-guide

**要求**:
- 行覆盖率 ≥80%
- 分支覆盖率 ≥70%

### 4. 模块依赖

**使用Skill**: modular-monolith

**检查项**:
- 循环依赖
- 依赖方向
- 跨层调用

## 输出格式

```markdown
# 代码审查报告

## 审查范围
- 文件数量: 5
- 代码行数: 320

## 问题汇总

| 级别 | 数量 | 状态 |
|------|------|------|
| 严重 | 0 | 通过 |
| 重要 | 2 | 警告 |
| 一般 | 5 | 警告 |
| 建议 | 3 | 信息 |

## 详细问题

### 重要问题

#### 1. 缺少输入验证
- **位置**: UserController.java:45
- **问题**: create方法未验证参数
- **建议**: 添加@Valid注解

#### 2. 测试覆盖不足
- **位置**: UserService
- **问题**: 覆盖率75%，低于80%
- **建议**: 补充边界条件测试

## 质量指标

| 指标 | 值 | 标准 | 状态 |
|------|-----|------|------|
| 测试覆盖率 | 75% | ≥80% | 失败 |
| 代码重复率 | 3% | ≤5% | 通过 |
| 圈复杂度 | 8 | ≤10 | 通过 |

## 结论
审查未通过，请修复重要问题后重新提交
```

## 问题分级

| 级别 | 说明 | 处理要求 |
|------|------|----------|
| 严重 | 安全漏洞、功能缺陷 | 必须修复 |
| 重要 | 性能问题、规范违规 | 强烈建议修复 |
| 一般 | 代码风格、可读性 | 建议修复 |
| 建议 | 优化建议 | 可选 |

## 参数

| 参数 | 说明 | 默认值 |
|------|------|--------|
| --scope | 审查范围 | changed |
| --module | 指定模块 | 全部 |
| --include-security | 深度安全扫描 | false |
| --fix | 自动修复简单问题 | false |

## 关联命令

- `/lcyf-security-scan` - 单独执行安全扫描
- `/lcyf-verify` - 执行构建验证

## 关联Agent

- code-reviewer
- security-reviewer
- tdd-guide

## 关联Skill

- modular-monolith

## 关联规则

- 02-编码风格
- 06-Java编码规范
- 01-安全规范
- 03-测试要求
