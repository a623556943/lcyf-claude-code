# /lcyf-安全扫描

## 概述

执行深度安全漏洞扫描，检测代码中的安全风险。

## 用法

```
/lcyf-安全扫描
/lcyf-安全扫描 --scope=changed    # 只扫描变更文件
/lcyf-安全扫描 --scope=module --module=system
/lcyf-安全扫描 --owasp            # OWASP Top 10 检查
```

## 扫描内容

### OWASP Top 10

| 编号 | 漏洞类型 | 检查内容 |
|------|----------|----------|
| A01 | 访问控制失效 | 权限检查缺失 |
| A02 | 加密失败 | 弱加密算法 |
| A03 | 注入攻击 | SQL/XSS注入 |
| A04 | 不安全设计 | 密码明文存储 |
| A05 | 安全配置错误 | 敏感端点暴露 |
| A06 | 易受攻击组件 | 依赖库漏洞 |
| A07 | 认证失败 | 弱密码策略 |
| A08 | 完整性失败 | 不安全反序列化 |
| A09 | 日志监控失败 | 敏感信息日志 |
| A10 | SSRF | 未验证的URL请求 |

### 敏感信息检测

| 类型 | 检测模式 |
|------|----------|
| API密钥 | `[A-Za-z0-9_-]{32,}` |
| 私钥 | `-----BEGIN.*PRIVATE KEY-----` |
| 密码 | `password\s*=\s*["'][^"']+["']` |
| 数据库URL | `jdbc:.*@.*:\d+` |

## 执行流程

```
1. 代码扫描
   └── 06-安全审查专家: 静态代码分析

2. 依赖检查
   └── 检查Maven依赖的已知漏洞

3. 配置检查
   └── 检查安全配置

4. 报告生成
   └── 生成安全审查报告
```

## 输出格式

```markdown
# 安全扫描报告

## 扫描概览
- 扫描文件: 45
- 扫描时间: 2025-01-26 10:00:00
- 风险等级: 🟠 中

## 漏洞汇总

| 风险 | 数量 | 说明 |
|------|------|------|
| 🔴 高 | 1 | 必须立即修复 |
| 🟠 中 | 3 | 建议尽快修复 |
| 🟡 低 | 5 | 按计划修复 |

## 详细发现

### 🔴 高风险

#### VULN-001: SQL注入风险
- **位置**: UserMapper.java:45
- **类型**: A03 注入攻击
- **代码**:
```java
@Select("SELECT * FROM user WHERE name = '" + name + "'")
```
- **修复建议**:
```java
@Select("SELECT * FROM user WHERE name = #{name}")
```

### 🟠 中风险

#### VULN-002: 硬编码密钥
- **位置**: PaymentConfig.java:12
- **类型**: A04 不安全设计
- **代码**:
```java
private static final String API_KEY = "sk-xxxxx";
```
- **修复建议**: 使用环境变量或配置中心

## 依赖漏洞

| 依赖 | 版本 | CVE | 严重性 |
|------|------|-----|--------|
| log4j-core | 2.14.0 | CVE-2021-44228 | 🔴 高 |

## 修复优先级

### 紧急（24小时内）
1. VULN-001: SQL注入

### 重要（1周内）
1. VULN-002: 硬编码密钥
2. 依赖: 升级log4j
```

## 参数

| 参数 | 说明 | 默认值 |
|------|------|--------|
| --scope | 扫描范围 | all |
| --module | 指定模块 | 全部 |
| --owasp | OWASP Top 10检查 | true |
| --deps | 依赖漏洞检查 | true |

## 关联命令

- `/lcyf-代码审查` - 综合代码审查
- `/lcyf-验证` - 执行验证

## 关联Agent

- 06-安全审查专家

## 关联规则

- 01-安全规范
