---
name: settlement-difference
description: |
  【模块定位】差额管理与补差结算

  【支持的代理】
  - java-developer: 实现差额管理

  【触发关键词】
  差额管理、差额导入、补差结算、差额单

  【必须调用】
  java-developer: 任务涉及"差额管理" → MUST
---

# Finance模块 业务逻辑详细文档（差额管理）

**文档创建时间**: 2026-01-28
**文档版本**: V1.0

---

## 模块职责

负责差额单的分页查询、模板下载与导入校验，并在导入时生成补差结算单、同步更新关联财务单金额。

## 核心功能

### Controller
- `FeeBalanceController.java` - 差额管理入口，负责分页/模板/导入

### Service
- `IFeeBalanceService.java` - 差额服务接口定义
- `FeeBalanceServiceImpl.java` - 差额导入校验、生成补差结算单、回写财务单

## 功能清单

| 功能 | 描述 |
|------|------|
| 差额分页 | 差额单分页查询 |
| 模板下载 | 下载差额导入模板 |
| 差额导入 | 导入差额单并生成补差结算单 |

## 关键设计决策

| 决策点 | 选择 | 原因 |
|--------|------|------|
| 导入文件格式 | 仅支持 xlsx | 读取时校验文件类型与后缀，保障模板一致性 |
| 差额类型 | 仅补发/扣回 | 以 `BalanceTypeEnum` 约束合法类型 |
| 结算单状态限制 | 仅结算中/待结算可导入 | 导入校验校验结算状态，避免已结算重复补差 |
| 导入联动 | 生成补差结算单并回写财务单 | 保持差额、结算单与财务单金额一致 |

---

**文档版本**: V1.0
