package com.lcyf.cloud.module.{{moduleName}}.biz.infrastructure.gateway;

import com.ejlchina.searcher.BeanSearcher;
import com.ejlchina.searcher.SearchResult;
import com.lcyf.cloud.framework.common.pojo.PageResult;
import com.lcyf.cloud.framework.mybatis.core.base.CrudRepository;
import com.lcyf.cloud.module.{{moduleName}}.biz.infrastructure.mapper.{{EntityName}}Mapper;
import com.lcyf.cloud.module.{{moduleName}}.biz.infrastructure.entity.{{EntityName}}Do;
import com.lcyf.cloud.module.{{moduleName}}.biz.infrastructure.assembler.{{EntityName}}Assembler;
import com.lcyf.cloud.module.{{moduleName}}.api.pojo.dto.{{EntityName}}Dto;
import com.lcyf.cloud.module.{{moduleName}}.api.pojo.cmd.{{EntityName}}AddCmd;
import com.lcyf.cloud.module.{{moduleName}}.api.pojo.cmd.{{EntityName}}UpdateCmd;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.util.Map;

/**
 * {{description}}Gateway
 * 数据访问层，负责与数据库交互
 *
 * @author {{author}}
 * @since {{date}}
 */
@Service
@RequiredArgsConstructor
public class {{EntityName}}Gateway extends CrudRepository<{{EntityName}}Mapper, {{EntityName}}Do> {

    private final {{EntityName}}Assembler {{entityName}}Assembler;
    private final BeanSearcher beanSearcher;

    /**
     * 分页查询{{description}}
     *
     * @param paraMap 查询参数
     * @return 分页结果
     */
    public PageResult<{{EntityName}}Dto> selectPage(Map<String, Object> paraMap) {
        SearchResult<{{EntityName}}Do> search = beanSearcher.search({{EntityName}}Do.class, paraMap);
        return {{entityName}}Assembler.convertPage(
            new PageResult<>(search.getDataList(), search.getTotalCount().longValue())
        );
    }

    /**
     * 根据ID查询{{description}}
     *
     * @param id 主键ID
     * @return {{description}}DTO
     */
    public {{EntityName}}Dto selectById(Long id) {
        return {{entityName}}Assembler.convert(super.getById(id));
    }

    /**
     * 新增{{description}}
     *
     * @param addCmd 新增命令
     * @return 主键ID
     */
    public Long save({{EntityName}}AddCmd addCmd) {
        {{EntityName}}Do entity = {{entityName}}Assembler.convert(addCmd);
        super.save(entity);
        return entity.getId();
    }

    /**
     * 修改{{description}}
     *
     * @param updateCmd 更新命令
     */
    public void updateById({{EntityName}}UpdateCmd updateCmd) {
        this.updateById({{entityName}}Assembler.convert(updateCmd));
    }
}
